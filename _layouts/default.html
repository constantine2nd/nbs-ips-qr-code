<!doctype html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{ page.title | default: site.title }}</title>
        <meta
            name="description"
            content="{{ page.description | default: site.description }}"
        />

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <!-- Custom CSS -->
        <link
            rel="stylesheet"
            href="{{ '/assets/css/main.css' | relative_url }}"
        />

        <!-- Site Configuration for JavaScript -->
        <script>
            window.SITE_CONFIG = {
                baseUrl: '{{ "/" | relative_url }}',
                templatesUrl: '{{ "/templates" | relative_url }}',
            };
        </script>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="{{ '/' | relative_url }}">
                    <i class="fas fa-qrcode me-2"></i>
                    NBS IPS QR
                </a>
                <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarNav"
                >
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ '/' | relative_url }}">
                                <i class="fas fa-home me-1"></i
                                ><span data-i18n="nav.home">Home</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                class="nav-link"
                                href="{{ '/generator' | relative_url }}"
                            >
                                <i class="fas fa-cogs me-1"></i
                                ><span data-i18n="nav.generator"
                                    >Generator</span
                                >
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                class="nav-link"
                                href="{{ '/validator' | relative_url }}"
                            >
                                <i class="fas fa-check-circle me-1"></i
                                ><span data-i18n="nav.validator"
                                    >Validator</span
                                >
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                class="nav-link"
                                href="{{ '/templates' | relative_url }}"
                            >
                                <i class="fas fa-file-alt me-1"></i
                                ><span data-i18n="nav.templates"
                                    >Templates</span
                                >
                            </a>
                        </li>
                    </ul>
                    <div class="navbar-nav">
                        <div class="nav-item dropdown">
                            <a
                                class="nav-link dropdown-toggle"
                                href="#"
                                id="languageDropdown"
                                role="button"
                                data-bs-toggle="dropdown"
                                aria-expanded="false"
                            >
                                <i class="fas fa-language me-1"></i>Latinica
                            </a>
                            <ul
                                class="dropdown-menu dropdown-menu-end"
                                aria-labelledby="languageDropdown"
                            >
                                <li>
                                    <a
                                        class="dropdown-item active"
                                        href="#"
                                        data-lang="sr_RS_Latn"
                                        >Latinica</a
                                    >
                                </li>
                                <li>
                                    <a
                                        class="dropdown-item"
                                        href="#"
                                        data-lang="sr_RS"
                                        >Ćirilica</a
                                    >
                                </li>
                                <li>
                                    <a
                                        class="dropdown-item"
                                        href="#"
                                        data-lang="en"
                                        >English</a
                                    >
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <main class="container-fluid py-4">{{ content }}</main>

        <!-- Templates Modal -->
        <div
            class="modal fade"
            id="templateModal"
            tabindex="-1"
            aria-labelledby="templateModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5
                            class="modal-title"
                            id="templateModalLabel"
                            data-i18n="modal.saveTemplate.title"
                        >
                            Save as Template
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <form id="templateForm">
                            <div class="mb-3">
                                <label
                                    for="templateName"
                                    class="form-label"
                                    data-i18n="modal.saveTemplate.name"
                                    >Template Name</label
                                >
                                <input
                                    type="text"
                                    class="form-control"
                                    id="templateName"
                                    required
                                />
                            </div>
                            <div class="mb-3">
                                <label
                                    for="templateDescription"
                                    class="form-label"
                                    data-i18n="modal.saveTemplate.description"
                                    >Description (optional)</label
                                >
                                <textarea
                                    class="form-control"
                                    id="templateDescription"
                                    rows="3"
                                ></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                            data-i18n="modal.saveTemplate.cancel"
                        >
                            Cancel
                        </button>
                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="saveTemplate()"
                            data-i18n="modal.saveTemplate.save"
                        >
                            Save Template
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Templates Modal -->
        <div
            class="modal fade"
            id="importModal"
            tabindex="-1"
            aria-labelledby="importModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5
                            class="modal-title"
                            id="importModalLabel"
                            data-i18n="modal.import.title"
                        >
                            Import Templates
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label
                                for="importFile"
                                class="form-label"
                                data-i18n="modal.import.selectFile"
                                >Select JSON file</label
                            >
                            <div class="custom-file-input-wrapper">
                                <input
                                    type="file"
                                    class="form-control"
                                    id="importFile"
                                    accept=".json"
                                />
                                <div class="file-input-overlay">
                                    <i class="fas fa-file-upload me-2"></i>
                                    <span
                                        class="file-input-text"
                                        data-i18n="modal.import.browse"
                                        >Browse...</span
                                    >
                                    <span
                                        class="file-input-status"
                                        data-i18n="modal.import.noFileSelected"
                                        >No files selected</span
                                    >
                                </div>
                            </div>
                        </div>
                        <style>
                            .custom-file-input-wrapper {
                                position: relative;
                            }
                            .file-input-overlay {
                                position: absolute;
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                display: flex;
                                align-items: center;
                                padding: 0.375rem 0.75rem;
                                background: #fff;
                                border: 1px solid #ced4da;
                                border-radius: 0.25rem;
                                pointer-events: none;
                                color: #6c757d;
                            }
                            .file-input-text {
                                margin-right: 0.5rem;
                                color: #495057;
                            }
                            .file-input-status {
                                color: #6c757d;
                                font-style: italic;
                            }
                            #importFile {
                                opacity: 0;
                                position: relative;
                                z-index: 1;
                            }
                            #importFile:focus + .file-input-overlay {
                                border-color: #80bdff;
                                box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
                            }
                        </style>
                        <script>
                            // Handle file selection display
                            document.addEventListener(
                                'DOMContentLoaded',
                                function () {
                                    const fileInput =
                                        document.getElementById('importFile');
                                    const fileText =
                                        document.querySelector(
                                            '.file-input-text'
                                        );
                                    const fileStatus =
                                        document.querySelector(
                                            '.file-input-status'
                                        );

                                    if (fileInput && fileText && fileStatus) {
                                        fileInput.addEventListener(
                                            'change',
                                            function () {
                                                if (this.files.length > 0) {
                                                    const fileName =
                                                        this.files[0].name;
                                                    fileStatus.textContent =
                                                        fileName;
                                                    fileStatus.style.color =
                                                        '#495057';
                                                    fileStatus.style.fontStyle =
                                                        'normal';
                                                } else {
                                                    fileStatus.textContent =
                                                        fileStatus.getAttribute(
                                                            'data-i18n'
                                                        ) ===
                                                        'modal.import.noFileSelected'
                                                            ? 'No files selected'
                                                            : 'Није изабрана датотека';
                                                    fileStatus.style.color =
                                                        '#6c757d';
                                                    fileStatus.style.fontStyle =
                                                        'italic';
                                                }
                                            }
                                        );
                                    }
                                }
                            );
                        </script>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                            data-i18n="modal.import.cancel"
                        >
                            Cancel
                        </button>
                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="importTemplates()"
                            data-i18n="modal.import.import"
                        >
                            Import
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Modal -->
        <div
            class="modal fade"
            id="loadingModal"
            tabindex="-1"
            data-bs-backdrop="static"
            data-bs-keyboard="false"
        >
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-body text-center">
                        <div
                            class="spinner-border text-primary mb-3"
                            role="status"
                        >
                            <span
                                class="visually-hidden"
                                data-i18n="common.loading"
                                >Loading...</span
                            >
                        </div>
                        <div data-i18n="modal.loading.text">
                            Processing request...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Internationalization -->
        <script src="{{ '/assets/js/i18n.js' | relative_url }}?v=20250910-FIXED"></script>
        <!-- Unified Language System - Must load before main.js to prevent ReferenceErrors -->
        <script src="{{ '/assets/js/unified-language-system.js' | relative_url }}?v=20250910-FIXED"></script>
        <!-- Custom JS -->
        <script src="{{ '/assets/js/main.js' | relative_url }}?v=20250910-FIXED"></script>
        <script src="{{ '/assets/js/templates.js' | relative_url }}?v=20250910-FIXED"></script>
        <script src="{{ '/assets/js/api.js' | relative_url }}?v=20250910-FIXED"></script>
    </body>
</html>
