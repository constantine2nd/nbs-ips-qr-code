<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Dropdown Test - NBS IPS QR</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Segoe UI', 'DejaVu Sans', 'Arial Unicode MS', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 70px;
        }

        .cyrillic-font {
            font-family: 'Segoe UI', 'DejaVu Sans', 'Arial Unicode MS', 'Times New Roman', serif;
        }

        .test-section {
            margin: 2rem 0;
            padding: 2rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
        }

        .lang-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
        }

        .translation-test {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .translation-test {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-qrcode me-2"></i>
                NBS IPS QR - Language Test
            </a>

            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" id="languageDropdown">
                        <i class="fas fa-language me-1"></i>Language
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" data-lang="sr_RS_Latn">Latinica</a></li>
                        <li><a class="dropdown-item" href="#" data-lang="sr_RS">Ćirilica</a></li>
                        <li><a class="dropdown-item" href="#" data-lang="en">English</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Language Indicator -->
    <div class="lang-indicator">
        <div class="card">
            <div class="card-body p-2">
                <small></small>Current: <span id="currentLangDisplay" class="fw-bold">Loading...</span></small>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    <i class="fas fa-globe me-2"></i>
                    <span data-i18n="test.title">Language Switching Test</span>
                </h1>
            </div>
        </div>

        <!-- Translation Examples -->
        <div class="test-section">
            <h3 data-i18n="test.translationExamples">Translation Examples</h3>
            <div class="translation-test">
                <div>
                    <h5 data-i18n="test.navigationItems">Navigation Items</h5>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <span data-i18n="nav.home">Home</span>
                            <code class="float-end">nav.home</code>
                        </li>
                        <li class="list-group-item">
                            <span data-i18n="nav.generator">Generator</span>
                            <code class="float-end">nav.generator</code>
                        </li>
                        <li class="list-group-item">
                            <span data-i18n="nav.validator">Validator</span>
                            <code class="float-end">nav.validator</code>
                        </li>
                        <li class="list-group-item">
                            <span data-i18n="nav.templates">Templates</span>
                            <code class="float-end">nav.templates</code>
                        </li>
                    </ul>
                </div>

                <div>
                    <h5 data-i18n="test.commonActions">Common Actions</h5>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <span data-i18n="common.save">Save</span>
                            <code class="float-end">common.save</code>
                        </li>
                        <li class="list-group-item">
                            <span data-i18n="common.cancel">Cancel</span>
                            <code class="float-end">common.cancel</code>
                        </li>
                        <li class="list-group-item">
                            <span data-i18n="common.loading">Loading...</span>
                            <code class="float-end">common.loading</code>
                        </li>
                        <li class="list-group-item">
                            <span data-i18n="common.success">Success</span>
                            <code class="float-end">common.success</code>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Form Test -->
        <div class="test-section">
            <h3 data-i18n="test.formElements">Form Elements</h3>
            <form class="row g-3">
                <div class="col-md-6">
                    <label for="testPaymentType" class="form-label" data-i18n="generator.form.paymentType.label">
                        Payment Type (K)
                    </label>
                    <select class="form-select" id="testPaymentType">
                        <option data-i18n="generator.form.paymentType.pr">Regular Payment (PR)</option>
                        <option data-i18n="generator.form.paymentType.pt">Point of Sale (PT)</option>
                        <option data-i18n="generator.form.paymentType.ek">E-Commerce (EK)</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="testAmount" class="form-label" data-i18n="generator.form.amount.label">
                        Amount (I)
                    </label>
                    <input type="text" class="form-control" id="testAmount" data-i18n="test.placeholderAmount" placeholder="Enter amount...">
                </div>
                <div class="col-12">
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>
                            <span data-i18n="common.save">Save</span>
                        </button>
                        <button type="button" class="btn btn-secondary">
                            <i class="fas fa-times me-1"></i>
                            <span data-i18n="common.cancel">Cancel</span>
                        </button>
                        <button type="button" class="btn btn-success">
                            <i class="fas fa-check me-1"></i>
                            <span data-i18n="common.success">Success</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Character Display Test -->
        <div class="test-section">
            <h3>Character Display Test</h3>
            <div class="row">
                <div class="col-md-4">
                    <h5>English</h5>
                    <p></p>QR Code Generator</p>
                    <p>Save Template</p>
                    <p>Validation Results</p>
                </div>
                <div class="col-md-4">
                    <h5>Serbian Latin</h5>
                    <p>Generator QR kodova</p>
                    <p>Sačuvaj šablon</p>
                    <p>Rezultati validacije</p>
                </div>
                <div class="col-md-4 cyrillic-font">
                    <h5>Serbian Cyrillic</h5>
                    <p>Генератор QR кодова</p>
                    <p>Сачувај шаблон</p>
                    <p>Резултати валидације</p>
                </div>
            </div>
        </div>

        <!-- Debug Information -->
        <div class="test-section">
            <h3>Debug Information</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>System Status</h5>
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>i18n Loaded:</span>
                            <span id="i18nStatus" class="badge bg-secondary">No</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Current Language:</span>
                            <span id="currentLang" class="badge bg-primary">-</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Dropdown Items:</span>
                            <span id="dropdownCount" class="badge bg-info">0</span>
                        </li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Test Actions</h5>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary" onclick="testLanguageSwitch('en')">
                            Switch to English
                        </button>
                        <button class="btn btn-outline-success" onclick="testLanguageSwitch('sr_RS_Latn')">
                            Switch to Latinica
                        </button>
                        <button class="btn btn-outline-info" onclick="testLanguageSwitch('sr_RS')">
                            Switch to Ćirilica
                        </button>
                        <button class="btn btn-outline-warning" onclick="forceRefreshTranslations()">
                            Force Refresh
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="alert alert-info">
            <h5><i class="fas fa-info-circle me-2"></i>Instructions</h5>
            <ol>
                <li>Use the language dropdown in the top navigation to test language switching</li>
                <li>Watch the text on this page change automatically</li>
                <li>Try the test buttons below to switch languages programmatically</li>
                <li>Check that Serbian Cyrillic characters display properly</li>
                <li>Verify the dropdown shows the correct current language</li>
            </ol>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Simple i18n translations for this test -->
    <script>
        // Minimal translations for testing
        const translations = {
            en: {
                test: {
                    title: "Language Switching Test",
                    translationExamples: "Translation Examples",
                    navigationItems: "Navigation Items",
                    commonActions: "Common Actions",
                    formElements: "Form Elements",
                    placeholderAmount: "Enter amount..."
                },
                nav: {
                    home: "Home",
                    generator: "Generator",
                    validator: "Validator",
                    templates: "Templates"
                },
                common: {
                    save: "Save",
                    cancel: "Cancel",
                    loading: "Loading...",
                    success: "Success"
                },
                generator: {
                    form: {
                        paymentType: {
                            label: "Payment Type (K)",
                            pr: "Regular Payment (PR)",
                            pt: "Point of Sale (PT)",
                            ek: "E-Commerce (EK)"
                        },
                        amount: {
                            label: "Amount (I)"
                        }
                    }
                }
            },
            sr_RS_Latn: {
                test: {
                    title: "Test prebacivanja jezika",
                    translationExamples: "Primeri prevoda",
                    navigationItems: "Stavke navigacije",
                    commonActions: "Česte akcije",
                    formElements: "Elementi forme",
                    placeholderAmount: "Unesi iznos..."
                },
                nav: {
                    home: "Početna",
                    generator: "Generator",
                    validator: "Validator",
                    templates: "Šabloni"
                },
                common: {
                    save: "Sačuvaj",
                    cancel: "Otkaži",
                    loading: "Učitavam...",
                    success: "Uspešno"
                },
                generator: {
                    form: {
                        paymentType: {
                            label: "Tip plaćanja (K)",
                            pr: "Regularno plaćanje (PR)",
                            pt: "Prodajno mesto (PT)",
                            ek: "E-trgovina (EK)"
                        },
                        amount: {
                            label: "Iznos (I)"
                        }
                    }
                }
            },
            sr_RS: {
                test: {
                    title: "Тест пребацивања језика",
                    translationExamples: "Примери превода",
                    navigationItems: "Ставке навигације",
                    commonActions: "Честе акције",
                    formElements: "Елементи форме",
                    placeholderAmount: "Унеси износ..."
                },
                nav: {
                    home: "Почетна",
                    generator: "Генератор",
                    validator: "Валидатор",
                    templates: "Шаблони"
                },
                common: {
                    save: "Сачувај",
                    cancel: "Откажи",
                    loading: "Учитавам...",
                    success: "Успешно"
                },
                generator: {
                    form: {
                        paymentType: {
                            label: "Тип плаћања (К)",
                            pr: "Регуларно плаћање (ПР)",
                            pt: "Продајно место (ПТ)",
                            ek: "Е-трговина (ЕК)"
                        },
                        amount: {
                            label: "Износ (И)"
                        }
                    }
                }
            }
        };

        let currentLanguage = 'sr_RS_Latn';

        // Simple translation function
        function t(key) {
            const keys = key.split('.');
            let result = translations[currentLanguage];

            for (const k of keys) {
                if (result && result[k]) {
                    result = result[k];
                } else {
                    return key;
                }
            }

            return result || key;
        }

        // Apply translations to page
        function applyTranslations() {
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = t(key);

                if (element.tagName === 'INPUT' && element.type !== 'submit') {
                    element.placeholder = translation;
                } else {
                    element.textContent = translation;
                }
            });

            // Update language indicator
            const indicator = document.getElementById('currentLangDisplay');
            if (indicator) {
                const names = {
                    'sr_RS_Latn': 'Latinica',
                    'sr_RS': 'Ћирилица',
                    'en': 'English'
                };
                indicator.textContent = names[currentLanguage];
            }
        }

        // Change language function
        function changeLanguage(lang) {
            console.log('Changing language to:', lang);
            currentLanguage = lang;
            localStorage.setItem('nbs_language', lang);

            // Update dropdown text
            const dropdownToggle = document.getElementById('languageDropdown');
            if (dropdownToggle) {
                const names = {
                    'sr_RS_Latn': 'Latinica',
                    'sr_RS': 'Ћирилица',
                    'en': 'English'
                };
                dropdownToggle.innerHTML = `<i class="fas fa-language me-1"></i>${names[lang]}`;
            }

            // Update active states
            document.querySelectorAll('[data-lang]').forEach(item => {
                if (item.getAttribute('data-lang') === lang) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });

            // Apply translations
            applyTranslations();
            updateDebugInfo();

            // Add visual feedback
            document.body.style.backgroundColor = '#e7f3ff';
            setTimeout(() => {
                document.body.style.backgroundColor = '';
            }, 500);
        }

        // Test functions
        function testLanguageSwitch(lang) {
            changeLanguage(lang);
        }

        function forceRefreshTranslations() {
            applyTranslations();
            updateDebugInfo();
        }

        function updateDebugInfo() {
            const i18nStatus = document.getElementById('i18nStatus');
            const currentLang = document.getElementById('currentLang');
            const dropdownCount = document.getElementById('dropdownCount');

            if (i18nStatus) {
                i18nStatus.textContent = window.i18n ? 'Yes' : 'No';
                i18nStatus.className = window.i18n ? 'badge bg-success' : 'badge bg-danger';
            }

            if (currentLang) {
                currentLang.textContent = currentLanguage;
            }

            if (dropdownCount) {
                const items = document.querySelectorAll('[data-lang]');
                dropdownCount.textContent = items.length;
            }
        }

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up language test...');

            // Load saved language
            const savedLang = localStorage.getItem('nbs_language');
            if (savedLang) {
                currentLanguage = savedLang;
            }

            // Set up dropdown listeners
            const languageItems = document.querySelectorAll('[data-lang]');
            languageItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const lang = this.getAttribute('data-lang');
                    console.log('Dropdown clicked:', lang);
                    changeLanguage(lang);

                    // Close dropdown
                    const dropdown = bootstrap.Dropdown.getInstance(document.getElementById('languageDropdown'));
                    if (dropdown) {
                        dropdown.hide();
                    }
                });
            });

            // Initial setup
            changeLanguage(currentLanguage);
            updateDebugInfo();

            // Update debug info periodically
            setInterval(updateDebugInfo, 2000);

            console.log('Language test setup complete');
        });
    </script>
</body>
</html>
